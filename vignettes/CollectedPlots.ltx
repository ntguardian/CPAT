%\VignetteIndexEntry{Power Plots}
%\VignetteEngine{R.rsp::tex}
%\VignetteKeyword{power}

\documentclass{article}
    % General document formatting
    \usepackage[margin=0.7in]{geometry}
    \usepackage[parfill]{parskip}
    \usepackage[utf8]{inputenc}
    
    % Related to math
    \usepackage{amsmath,amssymb,amsfonts,amsthm}

    \usepackage{tikz}
    \usepackage{graphicx}
    \usepackage{subcaption}

    \title{Power Plots}
    \date{\today}
    \author{Curtis Miller}

\begin{document}
\maketitle

The plots below are power simulations comparing the ability of different test
statistics to detect structural change in linear regression models. Here, $\beta
= (1, 2)^T$, so the regression model is $y_t = 1 + 2 x_t + \epsilon_t$, where
$\{\epsilon_t\}_{t \in \mathbb{N}}$ is a mean-zero stationary process and $x_t
\sim \operatorname{N}(1, 1)$, when the null hypothesis is true.

The test statistics displayed include the R\'enyi-type statistic with trimming
parameter $t_T = T^{1/2}$ computed with the regression model coefficients
directly (\tikz[baseline=-0.5ex] \draw[thick](0,0) -- (1,0);)
the R\'enyi-type statistic with trimming parameter $t_T = T^{1/2}$ computed on
the residuals
(\tikz[baseline=-0.5ex] \draw[thick, dash pattern=on 4pt off 4pt](0,0) -- 
(1,0);), the CUSUM statistic
(\tikz[baseline=-0.5ex] \draw[thick, dash pattern=on 8pt off 4pt](0,0) --
(1,0);), and the Hidalgo-Seo statistic
(\tikz[baseline=-0.5ex]\draw[thick, dash dot](0,0) -- (1,0);). The R\'enyi-type
statistic and CUSUM statistics are the univariate statistics computed on the
estimated residuals of the regression model. The Hidalgo-Seo statistic was
tailored to the regression context as described in their paper.

These statistics do not all use the same LRV procedure. The Hidalgo-Seo
statistic uses the periodogram matrix for LRV estimation. The univariate
statistics use the procedure described in \cite{horvathricemiller19}, which uses
the full sample but allows for changes in the mean of the univariate data. The
regression-coefficient-based R\'enyi-type statistic uses either the long-run
variance estimation procedure described in \cite{horvathmillerrice20} with
kernel methods (in the case of the ARMA(2, 2) process) or a procedure that does
not use kernel methods (for all other cases). The kernel used in the LRV
estimation procedures for all statistics using kernel methods (the R\'enyi-type
and CUSUM statistics) is the quadratic spectral kernel, and the bandwidth was
selected using the procedure advocated by \cite{andrews91b} and implemented in
\cite{cointReg16}.

Two different change point regimes are implemented. The first is an early change
point context. For a sample size $T$, the change point occurs near $T^{3/5}$ if
there is a change at all. If it does, the new model the data follows is $y_t =
(1 + \delta) + (2 - \delta) x_t + \epsilon_t$, where $\delta \in [-2, 2]$. The
second regime has the change occur near $\frac{T}{10}$.

In this document, $\epsilon_t$ is either homoskedastic or heteroskedastic. If
$\epsilon_t$ is homoskedastic, it follows one of four DGPs: independent and
identically distributed $N(0, 1)$ random variables; an AR(1) process with
autocorrelation coefficient $\phi = \sqrt{0.5} \approx 0.71$; an ARMA(2, 2)
process with $\phi_1 = 0.4$, $\phi_2 = -0.03$, $\theta_1 = 0.5$, $\theta_2 = 
0.06$, and the variance of the noise parameter is chosen so that the long-run
variance is one; and a GARCH(1, 1) process with $\omega = 0.2$, $\alpha = 0.2$,
and $\beta = 0.5$ (again the long-run variance is one). The proportional change
point is investigated only when the residuals are \textit{i.i.d.} Normal.

If $\epsilon_t$ is heteroskedastic, then it follows one of the four DGPs
followed by one of the homoskedastic versions for the first half of the sample.
In the second half of the sample, the model switches. In all cases, the LRV
scales from 1 to 10. If the data was \textit{i.i.d.} Normal or AR(1), that's
all that changes. In the ARMA(2, 2) and GARCH(1, 1) cases, though, the
structure of the dependency on past values changes as well, in addition to
the LRV change. For the ARMA(2, 2) case, the post-change process has
parameters $\phi_1 = 0.4$, $\phi_2 = 0.2$, $\theta_1 = -0.1$, $\theta_2 =
-0.42$. For the GARCH(1, 1) case, the post-change process has parameters
$\omega = 1$, $\alpha = 0.7$, $\beta = 0.2$. (The proportional change point was
not investigated in the heteroskedastic case.)

For every combination of sample size, test statistic, $\delta$, and
data-generating process for $\epsilon_t$, 20,000 independent test statistics
were simulated, and their asymptotically-appropriate $p$-values were computed.
$H_0$ is rejected for $p$-values less than $\alpha = 0.05$; the value of
$\alpha$ is signified with a dotted line (\tikz[baseline=-0.5ex]\draw[thick,
dotted](0,0) -- (1,0);). Values of $\delta$ increment by $0.1$, and the sample
sizes considered are $T \in \{50, 250, 1000\}$.

\begin{figure}
    \centering
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_n50.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_n250.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_n1000.pdf}
    \end{subfigure}
    \caption{Power plots for when the change occurs near  $T^{3/5}$;
             rows correspond to the sample sizes 50, 250, and 1000
             respectively, the first column is for \textit{iid} Normal
             residuals, the second column AR(1) residuals, the third column
             ARMA(2, 2) residuals, and the fourth column GARCH(1, 1) residuals.
             The $x$-axis tracks values of $\delta$ and the $y$-axis tracks
            observed power.}
         \label{fig:earlychangepower}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_hetero_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_hetero_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_hetero_n50.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_hetero_n50.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_hetero_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_hetero_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_hetero_n250.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_hetero_n250.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_norm_hetero_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_AR1_hetero_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_ARMA_hetero_n1000.pdf}
    \end{subfigure}
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_GARCH_hetero_n1000.pdf}
    \end{subfigure}
    \caption{Power plots for change with heteroskedasticity in residuals. The
             layout is similar to Figure \ref{fig:earlychangepower}.}
    \label{fig:earlyheterochangepower}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_prop_norm_n50.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_prop_norm_n250.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_prop_norm_n1000.pdf}
    \end{subfigure}
    \caption{Power plots for when the change occurs near $\frac{T}{10}$; see
             Figure \ref{fig:earlychangepower} for description.}
    \label{fig:propchangepower}
\end{figure}

In the case of homoskedastic residuals, the best-performing test statistic in
all plots is the Hidalgo-Seo statistic, but the statistic also always suffers
from considerable size inflation even for large sample sizes. The univariate
statistics (the CUSUM statistic and the univariate R\'enyi-type statistic) do
not demonstrate good power properties; sometimes they experience size
inflation, they have bad power for large sample sizes, and in the case of the
ARMA-type residuals models they even have power curves with the wrong shape. The
CUSUM statistic is the worst performing while the univariate R\'enyi-type
statistic sometimes has decent power for large sample sizes. On balance,
though, the regression-based R\'enyi-type often has excellent power without
suffering from size inflation; in fact, for the ARMA-type residuals, the
statistic (using kernel methods for LRV estimation) has a smaller size than
specified.  

In the case of heteroskedastic residuals, the univariate statistics have
effectively no power. The Hidalgo-Seo statistic has some power at the cost of
massive size inflation. All statistics struggle at smaller sample sizes, but the
R\'enyi-type statistic shines for larger sample sizes, being both appropriately
sized and having good power, sometimes even beating the ill-sized Hidalgo-Seo
statistic.

Now consider a three-variable regression model $y_t = \beta_0 + \beta_1 x_{1t} +
\beta_2 x_{2t} + \beta_3 x_{3t} + \epsilon_t$. We wish to see how well the
methods considered here can detect changes in this higher-dimensional model.
Under the null hypothesis, $\beta = (1, 2, 3, 4)^T$, while under the
alternative, $\beta = \left( (1 + \delta), (2 - \delta), (3 + \delta),
(4 - \delta) \right)^T $, with $\delta \in [-2, 2]$ after the change point. The
setup is otherwise the same (including $x_{jt} \sim \operatorname{N}(1, 1)$),
but we only consider Normal error terms.

The results are shown in Figure \ref{fig:4Dchange}. Higher dimension does appear
to have an effect on the power of all the statistics considered. Power appears
to be worse and often has undesirable properties; all statistics for a sample
size of 50 are effectively junk. In all cases, the size inflation of the
Hidalgo-Seo statistic appears to have become even worse. But when the sample
size is 250, the new statistic appears to have desirable power properties, and
for a sample size of 1000 the statistic performs well. These plots should serve
as a warning against attempting to detect changes in higher-dimensional
regression models when the sample size is not large.

\begin{figure}
    \centering
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_n50.pdf}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_hetero_n50.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_n250.pdf}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_hetero_n250.pdf}
    \end{subfigure}

    \bigskip
    \begin{subfigure}{.2\textwidth}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_n1000.pdf}
        \includegraphics[width=\textwidth]{power_plot_4D_norm_hetero_n1000.pdf}
    \end{subfigure}
    \caption{Power plots for change in a three-variable regression model; see
             Figure \ref{fig:earlychangepower} for description.}
    \label{fig:4Dchange}
\end{figure}

\bibliography{../inst/REFERENCES.bib} 
\bibliographystyle{ieeetr}

\end{document}

