################################################################################
# test-MathFunctions.R
################################################################################
# 2018-12-18
# Curtis Miller
################################################################################
# Tests for math functions of CPAT.
################################################################################

################################################################################
# SCAFFOLDING
################################################################################

context("Math functions")
library(CPAT)

x <- ((-10):10)/5

################################################################################
# MATHEMATICS FUNCTIONS TESTS
################################################################################

test_that("besselJ_zeros works", {
  expect_equal(CPAT:::besselJ_zeros(4), c(3.83170597020751, 7.01558666981562,
                                          10.1734681350627, 13.3236919363142))
  expect_equal(CPAT:::besselJ_zeros(a = 3, b = 10, nu = 3.5),
               c(13.6980231532492, 16.9236212852138, 20.1218061744538,
                 23.3042469889397, 26.4767636645391, 29.6426045403158, 
                 32.8037323851961, 35.961405804709))
  expect_error(CPAT:::besselJ_zeros(b = -1), "Must have a <= b")
  expect_error(CPAT:::besselJ_zeros(a = -1, b = 1), "Must have a >= 1")
})

test_that("kernel functions work", {
  expect_equal(CPAT:::ba_kernel_r(x),
               c(0, 0, 0, 0, 0, 0, 0.2, 0.4, 0.6, 0.8, 1, 0.8, 0.6, 0.4, 0.2, 0,
                 0, 0, 0, 0, 0))
  expect_equal(CPAT:::tr_kernel_r(x),
               c(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0))
  expect_equal(CPAT:::pa_kernel_r(x),
               c(0, 0, 0, 0, 0, 0, 0.016, 0.128, 0.424, 0.808, 1, 0.808, 0.424,
                 0.128, 0.016, 0, 0, 0, 0, 0, 0))
  expect_equal(CPAT:::th_kernel_r(x),
               c(0, 0, 0, 0, 0, 0, 0.0954915028125263, 0.345491502812526,
                 0.654508497187474, 0.904508497187474, 1, 0.904508497187474,
                 0.654508497187474, 0.345491502812526, 0.0954915028125263, 0,
                 0, 0, 0, 0, 0))
  expect_equal(CPAT:::qs_kernel_r(x),
               c(-0.00965080085555332, -0.0524660737072547, -0.0832644889640548, 
                 -0.07493564729680910, -0.0043612437366595,  0.1378605816745940, 
                  0.34092724443300000,  0.5734882380838300,  0.7903138214043160,
                  0.94429321995961500,  1,                   0.9442932199596150,
                  0.79031382140431600,  0.5734882380838300,  0.3409272444330000, 
                  0.13786058167459400, -0.0043612437366595, -0.0749356472968091,
                 -0.08326448896405480, -0.0524660737072547,
                 -0.00965080085555332))
})

################################################################################
# MATH UTILITIES TESTS
################################################################################

test_that("pBst_summand_solver works", {
  expect_equal(pBst_summand_solver(1, 1), 5)
  expect_equal(pBst_summand_solver(-1, 1), 1)
})

test_that("dBst_summand_solver words", {
  expect_equal(dBst_summand_solver(1, 1), 5)
  expect_equal(dBst_summand_solver(-1, 1), 1)
})
